<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>cilium - Blog</title><link rel="manifest" href="/blog/manifest.json"><meta name="application-name" content="Blog"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Cilium은 eBPF (Berkeley Packet Filter)를 기반으로 Pod Network 환경 + 보안 을 제공하는 CNI Plugin 입니다 Kubernetes와 같은 Linux 컨테이너 관리 플랫폼을 사용하여 배포된 응용 프로그램 서비스 간의 네트워크 및 API 연결을 제공하는 오픈 소스 소프트웨어 입니다. BPF&amp;#x2F;eBPF 소개 -"><meta property="og:type" content="blog"><meta property="og:title" content="cilium"><meta property="og:url" content="https://seongtaekkim.github.io/blog/2024/10/27/docs/cilium/cilium/"><meta property="og:site_name" content="Blog"><meta property="og:description" content="Cilium은 eBPF (Berkeley Packet Filter)를 기반으로 Pod Network 환경 + 보안 을 제공하는 CNI Plugin 입니다 Kubernetes와 같은 Linux 컨테이너 관리 플랫폼을 사용하여 배포된 응용 프로그램 서비스 간의 네트워크 및 API 연결을 제공하는 오픈 소스 소프트웨어 입니다. BPF&amp;#x2F;eBPF 소개 -"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://seongtaekkim.github.io/blog/img/cilium-01.png"><meta property="og:image" content="https://seongtaekkim.github.io/blog/img/cilium-02.png"><meta property="og:image" content="https://seongtaekkim.github.io/blog/img/cilium-03.png"><meta property="og:image" content="https://seongtaekkim.github.io/blog/img/cilium-04.png"><meta property="og:image" content="https://seongtaekkim.github.io/blog/img/cilium-05.png"><meta property="og:image" content="https://seongtaekkim.github.io/blog/img/cilium-06.png"><meta property="og:image" content="https://seongtaekkim.github.io/blog/img/cilium-07.png"><meta property="og:image" content="https://seongtaekkim.github.io/blog/img/cilium-08.png"><meta property="og:image" content="https://seongtaekkim.github.io/blog/img/cilium-09.png"><meta property="og:image" content="https://seongtaekkim.github.io/blog/img/cilium-10.png"><meta property="article:published_time" content="2024-10-26T16:30:35.000Z"><meta property="article:modified_time" content="2024-10-26T17:28:01.788Z"><meta property="article:author" content="Seongtaek Kim"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://seongtaekkim.github.io/blog/img/cilium-01.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://seongtaekkim.github.io/blog/2024/10/27/docs/cilium/cilium/"},"headline":"cilium","image":["https://seongtaekkim.github.io/blog/img/cilium-01.png","https://seongtaekkim.github.io/blog/img/cilium-02.png","https://seongtaekkim.github.io/blog/img/cilium-03.png","https://seongtaekkim.github.io/blog/img/cilium-04.png","https://seongtaekkim.github.io/blog/img/cilium-05.png","https://seongtaekkim.github.io/blog/img/cilium-06.png","https://seongtaekkim.github.io/blog/img/cilium-07.png","https://seongtaekkim.github.io/blog/img/cilium-08.png","https://seongtaekkim.github.io/blog/img/cilium-09.png","https://seongtaekkim.github.io/blog/img/cilium-10.png"],"datePublished":"2024-10-26T16:30:35.000Z","dateModified":"2024-10-26T17:28:01.788Z","author":{"@type":"Person","name":"Seongtaek Kim"},"publisher":{"@type":"Organization","name":"Blog","logo":{"@type":"ImageObject"}},"description":"Cilium은 eBPF (Berkeley Packet Filter)를 기반으로 Pod Network 환경 + 보안 을 제공하는 CNI Plugin 입니다 Kubernetes와 같은 Linux 컨테이너 관리 플랫폼을 사용하여 배포된 응용 프로그램 서비스 간의 네트워크 및 API 연결을 제공하는 오픈 소스 소프트웨어 입니다. BPF&#x2F;eBPF 소개 -"}</script><link rel="canonical" href="https://seongtaekkim.github.io/blog/2024/10/27/docs/cilium/cilium/"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/blog/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/blog/">Blog</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/blog/">Home</a><a class="navbar-item" href="/blog/archives">Archives</a><a class="navbar-item" href="/blog/categories">Categories</a><a class="navbar-item" href="/blog/tags">Tags</a></div><div class="navbar-end"><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-10-26T16:30:35.000Z" title="2024. 10. 27. 오전 1:30:35">2024-10-27</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-10-26T17:28:01.788Z" title="2024. 10. 27. 오전 2:28:01">2024-10-27</time></span><span class="level-item"><a class="link-muted" href="/blog/categories/cilium-cilium/">cilium/cilium</a></span><span class="level-item">27 minutes read (About 4051 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">cilium</h1><div class="content"><p>Cilium은 eBPF (Berkeley Packet Filter)를 기반으로 Pod Network 환경 + 보안 을 제공하는 CNI Plugin 입니다</p>
<p>Kubernetes와 같은 Linux 컨테이너 관리 플랫폼을 사용하여 배포된 응용 프로그램 서비스 간의 네트워크 및 API 연결을 제공하는 오픈 소스 소프트웨어 입니다.</p>
<h3 id="BPF-x2F-eBPF-소개-링크"><a href="#BPF-x2F-eBPF-소개-링크" class="headerlink" title="BPF&#x2F;eBPF 소개 - 링크"></a>BPF&#x2F;eBPF 소개 - <a target="_blank" rel="noopener" href="https://hyeyoo.com/133">링크</a></h3><p>Linux Network Stack : 리눅스 네트워크 스택의 단점은 복잡하고, 변경에 시간이 걸리고, 레이어를 건너뛰기 어렵다.</p>
<p><img src="/blog/img/cilium-01.png"></p>
<p>IPTables&#x2F;Netfilter 방식과 eBPF 방식 비교를 잘 설명한 포스팅 <a target="_blank" rel="noopener" href="https://blog.naver.com/kangdorr/222593265958">끄적끄적 공간 : 네이버 블로그</a></p>
<p><img src="/blog/img/cilium-02.png"></p>
<h3 id="Cilium-소개"><a href="#Cilium-소개" class="headerlink" title="Cilium 소개"></a>Cilium 소개</h3><p>Cilium은 eBPF (Berkeley Packet Filter)를 기반으로 Pod Network 환경 + 보안 을 제공하는 CNI Plugin 입니다</p>
<p>Kubernetes와 같은 Linux 컨테이너 관리 플랫폼을 사용하여 배포된 응용 프로그램 서비스 간의 네트워크 및 API 연결을 제공하는 오픈 소스 소프트웨어 입니다.</p>
<h3 id="Cilium-아키텍처"><a href="#Cilium-아키텍처" class="headerlink" title="Cilium 아키텍처"></a>Cilium 아키텍처</h3><p><img src="/blog/img/cilium-03.png"></p>
<ul>
<li>Cilium <strong>Agent</strong> : 데몬셋으로 실행, K8S API 설정으로 부터 ‘네트워크 설정, 네트워크 정책, 서비스 부하분산, 모니터링’ 등을 수행하며, eBPF 프로그램을 관리한다.</li>
<li>Cilium <strong>Client</strong> (CLI) : Cilium 커멘드툴, eBPF maps 에 직접 접속하여 상태를 확인할 수 있다.</li>
<li>Cilium <strong>Operator</strong> : K8S 클러스터에 대한 한 번씩 처리해야 하는 작업을 관리.</li>
<li><strong>Hubble</strong> : 네트워크와 보안 모니터링 플랫폼 역할을 하여, ‘Server, Relay, Client, Graphical UI’ 로 구성되어 있다.</li>
<li><strong>Data Store</strong> : Cilium Agent 간의 상태를 저장하고 전파하는 데이터 저장소, 2가지 종류 중 선택(K8S CRDs, Key-Value Store)</li>
</ul>
<p><img src="/blog/img/cilium-04.png"></p>
<p><img src="/blog/img/cilium-05.png"></p>
<p><img src="/blog/img/cilium-06.png"></p>
<h2 id="Cilium-배포"><a href="#Cilium-배포" class="headerlink" title="Cilium 배포"></a>Cilium 배포</h2><p>Cilium 설치 정보(w&#x2F;Helm) 및 확인 - <a target="_blank" rel="noopener" href="https://docs.cilium.io/en/stable/helm-reference/">Docs</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 모니터링</span></span><br><span class="line">watch -d kubectl get node,pod -A -owide</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">helm repo add cilium https://helm.cilium.io/</span><br><span class="line">helm repo update</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">helm install cilium cilium/cilium --version 1.16.3 --namespace kube-system \</span><br><span class="line">--<span class="built_in">set</span> k8sServiceHost=192.168.10.10 --<span class="built_in">set</span> k8sServicePort=6443 --<span class="built_in">set</span> debug.enabled=<span class="literal">true</span> \</span><br><span class="line">--<span class="built_in">set</span> rollOutCiliumPods=<span class="literal">true</span> --<span class="built_in">set</span> routingMode=native --<span class="built_in">set</span> autoDirectNodeRoutes=<span class="literal">true</span> \</span><br><span class="line">--<span class="built_in">set</span> bpf.masquerade=<span class="literal">true</span> --<span class="built_in">set</span> bpf.hostRouting=<span class="literal">true</span> --<span class="built_in">set</span> endpointRoutes.enabled=<span class="literal">true</span> \</span><br><span class="line">--<span class="built_in">set</span> ipam.mode=kubernetes --<span class="built_in">set</span> k8s.requireIPv4PodCIDR=<span class="literal">true</span> --<span class="built_in">set</span> kubeProxyReplacement=<span class="literal">true</span> \</span><br><span class="line">--<span class="built_in">set</span> ipv4NativeRoutingCIDR=192.168.0.0/16 --<span class="built_in">set</span> installNoConntrackIptablesRules=<span class="literal">true</span> \</span><br><span class="line">--<span class="built_in">set</span> hubble.ui.enabled=<span class="literal">true</span> --<span class="built_in">set</span> hubble.relay.enabled=<span class="literal">true</span> --<span class="built_in">set</span> prometheus.enabled=<span class="literal">true</span> --<span class="built_in">set</span> operator.prometheus.enabled=<span class="literal">true</span> --<span class="built_in">set</span> hubble.metrics.enableOpenMetrics=<span class="literal">true</span> \</span><br><span class="line">--<span class="built_in">set</span> hubble.metrics.enabled=<span class="string">&quot;&#123;dns:query;ignoreAAAA,drop,tcp,flow,port-distribution,icmp,httpV2:exemplars=true;labelsContext=source_ip\,source_namespace\,source_workload\,destination_ip\,destination_namespace\,destination_workload\,traffic_direction&#125;&quot;</span> \</span><br><span class="line">--<span class="built_in">set</span> operator.replicas=1</span><br><span class="line"></span><br><span class="line"><span class="comment">## 주요 파라미터 설명</span></span><br><span class="line">--<span class="built_in">set</span> debug.enabled=<span class="literal">true</span> <span class="comment"># cilium 파드에 로그 레벨을 debug 설정</span></span><br><span class="line">--<span class="built_in">set</span> autoDirectNodeRoutes=<span class="literal">true</span> <span class="comment"># 동일 대역 내의 노드들 끼리는 상대 노드의 podCIDR 대역의 라우팅이 자동으로 설정</span></span><br><span class="line">--<span class="built_in">set</span> endpointRoutes.enabled=<span class="literal">true</span> <span class="comment"># 호스트에 endpoint(파드)별 개별 라우팅 설정</span></span><br><span class="line">--<span class="built_in">set</span> hubble.relay.enabled=<span class="literal">true</span> --<span class="built_in">set</span> hubble.ui.enabled=<span class="literal">true</span> <span class="comment"># hubble 활성화</span></span><br><span class="line">--<span class="built_in">set</span> ipam.mode=kubernetes --<span class="built_in">set</span> k8s.requireIPv4PodCIDR=<span class="literal">true</span> <span class="comment"># k8s IPAM 활용</span></span><br><span class="line">--<span class="built_in">set</span> kubeProxyReplacement=<span class="literal">true</span> <span class="comment"># kube-proxy 없이 (최대한) 대처할수 있수 있게</span></span><br><span class="line">--<span class="built_in">set</span> ipv4NativeRoutingCIDR=192.168.0.0/16 <span class="comment"># 해당 대역과 통신 시 IP Masq 하지 않음, 보통 사내망 대역을 지정</span></span><br><span class="line">--<span class="built_in">set</span> operator.replicas=1 <span class="comment"># cilium-operator 파드 기본 1개</span></span><br><span class="line">--<span class="built_in">set</span> enableIPv4Masquerade=<span class="literal">true</span> --<span class="built_in">set</span> bpf.masquerade=<span class="literal">true</span> <span class="comment"># 파드를 위한 Masquerade , 추가로 Masquerade 을 BPF 로 처리 &gt;&gt; enableIPv4Masquerade=true 인 상태에서 추가로 bpf.masquerade=true 적용이 가능</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 설정 및 확인</span></span><br><span class="line">ip -c addr</span><br><span class="line">kubectl get node,pod,svc -A -owide</span><br><span class="line">iptables -t nat -S</span><br><span class="line">iptables -t filter -S</span><br><span class="line">iptables -t raw -S</span><br><span class="line">iptables -t mangle -S</span><br><span class="line">conntrack -L</span><br><span class="line"></span><br><span class="line">kubectl get crd</span><br><span class="line">kubectl get ciliumnodes <span class="comment"># cilium_host 인터페이스의 IP 확인 : CILIUMINTERNALIP</span></span><br><span class="line">kubectl get ciliumendpoints -A</span><br><span class="line"></span><br><span class="line">kubectl get cm -n kube-system cilium-config -o json | jq</span><br><span class="line"></span><br><span class="line">kubetail -n kube-system -l k8s-app=cilium --since 1h</span><br><span class="line">kubetail -n kube-system -l k8s-app=cilium-envoy --since 1h</span><br><span class="line"></span><br><span class="line"><span class="comment"># Native XDP 지원 NIC 확인 : https://docs.cilium.io/en/stable/bpf/progtypes/#xdp-drivers</span></span><br><span class="line">ethtool -i ens5</span><br><span class="line">driver: ena</span><br><span class="line">version: 6.8.0-1015-aws</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># https://docs.cilium.io/en/stable/operations/performance/tuning/#bypass-iptables-connection-tracking</span></span><br><span class="line">watch -d kubectl get pod -A <span class="comment"># 모니터링</span></span><br><span class="line">helm upgrade cilium cilium/cilium --namespace kube-system --reuse-values --<span class="built_in">set</span> installNoConntrackIptablesRules=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 확인: 기존 raw 에 아래 rule 추가 확인</span></span><br><span class="line">iptables -t raw -S | grep notrack</span><br><span class="line">-A CILIUM_OUTPUT_raw -d 192.168.0.0/16 -m comment --comment <span class="string">&quot;cilium: NOTRACK for pod traffic&quot;</span> -j CT --notrack</span><br><span class="line">-A CILIUM_OUTPUT_raw -s 192.168.0.0/16 -m comment --comment <span class="string">&quot;cilium: NOTRACK for pod traffic&quot;</span> -j CT --notrack</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">conntrack -F</span><br><span class="line">conntrack -L</span><br><span class="line">conntrack -L |grep -v 2379</span><br></pre></td></tr></table></figure>



<p>Cilium CLI 설치 : inspect the state of a Cilium installation, and enable&#x2F;disable various features (e.g. clustermesh, Hubble) - <a target="_blank" rel="noopener" href="https://docs.cilium.io/en/stable/installation/k8s-install-helm/#validate-the-installation">Link</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Cilium CLI 설치</span></span><br><span class="line">CILIUM_CLI_VERSION=$(curl -s https://raw.githubusercontent.com/cilium/cilium-cli/main/stable.txt)</span><br><span class="line">CLI_ARCH=amd64</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="subst">$(uname -m)</span>&quot;</span> = <span class="string">&quot;aarch64&quot;</span> ]; <span class="keyword">then</span> CLI_ARCH=arm64; <span class="keyword">fi</span></span><br><span class="line">curl -L --fail --remote-name-all https://github.com/cilium/cilium-cli/releases/download/<span class="variable">$&#123;CILIUM_CLI_VERSION&#125;</span>/cilium-linux-<span class="variable">$&#123;CLI_ARCH&#125;</span>.tar.gz&#123;,.<span class="built_in">sha256sum</span>&#125;</span><br><span class="line"><span class="built_in">sha256sum</span> --check cilium-linux-<span class="variable">$&#123;CLI_ARCH&#125;</span>.tar.gz.sha256sum</span><br><span class="line">sudo tar xzvfC cilium-linux-<span class="variable">$&#123;CLI_ARCH&#125;</span>.tar.gz /usr/local/bin</span><br><span class="line"><span class="built_in">rm</span> cilium-linux-<span class="variable">$&#123;CLI_ARCH&#125;</span>.tar.gz&#123;,.<span class="built_in">sha256sum</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 확인</span></span><br><span class="line">cilium status --<span class="built_in">wait</span></span><br><span class="line">cilium config view</span><br><span class="line"></span><br><span class="line">    /¯¯\</span><br><span class="line"> /¯¯\__/¯¯\    Cilium:             OK</span><br><span class="line"> \__/¯¯\__/    Operator:           OK</span><br><span class="line"> /¯¯\__/¯¯\    Envoy DaemonSet:    OK</span><br><span class="line"> \__/¯¯\__/    Hubble Relay:       OK</span><br><span class="line">    \__/       ClusterMesh:        disabled</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># cilium 데몬셋 파드 내에서 cilium 명령어로 상태 확인</span></span><br><span class="line"><span class="built_in">export</span> CILIUMPOD0=$(kubectl get -l k8s-app=cilium pods -n kube-system --field-selector spec.nodeName=k8s-s  -o jsonpath=<span class="string">&#x27;&#123;.items[0].metadata.name&#125;&#x27;</span>)</span><br><span class="line"><span class="built_in">alias</span> c0=<span class="string">&quot;kubectl exec -it <span class="variable">$CILIUMPOD0</span> -n kube-system -c cilium-agent -- cilium&quot;</span></span><br><span class="line">c0 status --verbose</span><br><span class="line">...</span><br><span class="line">KubeProxyReplacement:   True   [ens5   192.168.10.10 fe80::57:abff:fee3:da8d (Direct Routing)]</span><br><span class="line">...</span><br><span class="line">IPAM:                   IPv4: 2/254 allocated from 172.16.0.0/24, </span><br><span class="line">Allocated addresses:</span><br><span class="line">  172.16.0.159 (router)</span><br><span class="line">  172.16.0.171 (health)</span><br><span class="line">...</span><br><span class="line">Routing:                Network: Native   Host: BPF</span><br><span class="line">...</span><br><span class="line">Device Mode:            veth</span><br><span class="line">Masquerading:           BPF   [ens5]   192.168.0.0/16 [IPv4: Enabled, IPv6: Disabled]</span><br><span class="line">...  </span><br><span class="line">Proxy Status:            OK, ip 172.16.0.159, 0 redirects active on ports 10000-20000, Envoy: external</span><br><span class="line">...</span><br><span class="line">KubeProxyReplacement Details:</span><br><span class="line">  Status:                 True</span><br><span class="line">  Socket LB:              Enabled</span><br><span class="line">  Socket LB Tracing:      Enabled</span><br><span class="line">  Socket LB Coverage:     Full</span><br><span class="line">  Devices:                ens5   192.168.10.10 fe80::57:abff:fee3:da8d (Direct Routing)</span><br><span class="line">  Mode:                   SNAT</span><br><span class="line">  Backend Selection:      Random</span><br><span class="line">  Session Affinity:       Enabled</span><br><span class="line">  Graceful Termination:   Enabled</span><br><span class="line">  NAT46/64 Support:       Disabled</span><br><span class="line">  XDP Acceleration:       Disabled</span><br><span class="line">  Services:</span><br><span class="line">  - ClusterIP:      Enabled</span><br><span class="line">  - NodePort:       Enabled (Range: 30000-32767) </span><br><span class="line">  - LoadBalancer:   Enabled </span><br><span class="line">  - externalIPs:    Enabled </span><br><span class="line">  - HostPort:       Enabled</span><br><span class="line">BPF Maps:   dynamic sizing: on (ratio: 0.002500)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># Native Routing 확인 : # 192.168.0.0/16 대역은 IP Masq 없이 라우팅</span></span><br><span class="line">c0 status | grep KubeProxyReplacement</span><br><span class="line">KubeProxyReplacement:    True   [ens5   192.168.10.10 fe80::35:fff:fee7:de77 (Direct Routing)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># enableIPv4Masquerade=true(기본값) , bpf.masquerade=true 확인</span></span><br><span class="line">cilium config view | egrep <span class="string">&#x27;enable-ipv4-masquerade|enable-bpf-masquerade&#x27;</span></span><br><span class="line">enable-bpf-masquerade                          <span class="literal">true</span></span><br><span class="line">enable-ipv4-masquerade                         <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">c0 status --verbose | grep Masquerading</span><br><span class="line">Masquerading:           BPF   [ens5]   192.168.0.0/16 [IPv4: Enabled, IPv6: Disabled]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Configure the eBPF-based ip-masq-agent</span></span><br><span class="line"><span class="comment"># https://docs.cilium.io/en/stable/network/concepts/masquerading/</span></span><br><span class="line">helm upgrade cilium cilium/cilium --namespace kube-system --reuse-values --<span class="built_in">set</span> ipMasqAgent.enabled=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">cilium config view | grep -i masq</span><br><span class="line">enable-bpf-masquerade                             <span class="literal">true</span></span><br><span class="line">enable-ip-masq-agent                              <span class="literal">true</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> CILIUMPOD0=$(kubectl get -l k8s-app=cilium pods -n kube-system --field-selector spec.nodeName=k8s-s  -o jsonpath=<span class="string">&#x27;&#123;.items[0].metadata.name&#125;&#x27;</span>)</span><br><span class="line"><span class="built_in">alias</span> c0=<span class="string">&quot;kubectl exec -it <span class="variable">$CILIUMPOD0</span> -n kube-system -c cilium-agent -- cilium&quot;</span></span><br><span class="line">c0 status --verbose | grep Masquerading</span><br><span class="line">Masquerading:           BPF (ip-masq-agent)   [ens5]   192.168.0.0/16 [IPv4: Enabled, IPv6: Disabled]</span><br><span class="line"></span><br><span class="line">kubectl get cm -n kube-system cilium-config -o yaml  | grep ip-masq</span><br><span class="line">  enable-ip-masq-agent: <span class="string">&quot;true&quot;</span></span><br></pre></td></tr></table></figure>





<h3 id="Cilium-기본-정보-확인"><a href="#Cilium-기본-정보-확인" class="headerlink" title="Cilium 기본 정보 확인"></a>Cilium 기본 정보 확인</h3><p>변수 &amp; 단축키</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># cilium 파드 이름</span><br><span class="line">export CILIUMPOD0=$(kubectl get -l k8s-app=cilium pods -n kube-system --field-selector spec.nodeName=k8s-s  -o jsonpath=&#x27;&#123;.items[0].metadata.name&#125;&#x27;)</span><br><span class="line">export CILIUMPOD1=$(kubectl get -l k8s-app=cilium pods -n kube-system --field-selector spec.nodeName=k8s-w1 -o jsonpath=&#x27;&#123;.items[0].metadata.name&#125;&#x27;)</span><br><span class="line">export CILIUMPOD2=$(kubectl get -l k8s-app=cilium pods -n kube-system --field-selector spec.nodeName=k8s-w2 -o jsonpath=&#x27;&#123;.items[0].metadata.name&#125;&#x27;)</span><br><span class="line"></span><br><span class="line"># 단축키(alias) 지정</span><br><span class="line">alias c0=&quot;kubectl exec -it $CILIUMPOD0 -n kube-system -c cilium-agent -- cilium&quot;</span><br><span class="line">alias c1=&quot;kubectl exec -it $CILIUMPOD1 -n kube-system -c cilium-agent -- cilium&quot;</span><br><span class="line">alias c2=&quot;kubectl exec -it $CILIUMPOD2 -n kube-system -c cilium-agent -- cilium&quot;</span><br><span class="line"></span><br><span class="line">alias c0bpf=&quot;kubectl exec -it $CILIUMPOD0 -n kube-system -c cilium-agent -- bpftool&quot;</span><br><span class="line">alias c1bpf=&quot;kubectl exec -it $CILIUMPOD1 -n kube-system -c cilium-agent -- bpftool&quot;</span><br><span class="line">alias c2bpf=&quot;kubectl exec -it $CILIUMPOD2 -n kube-system -c cilium-agent -- bpftool&quot;</span><br><span class="line"></span><br><span class="line"># Hubble UI 웹 접속</span><br><span class="line">kubectl patch -n kube-system svc hubble-ui -p &#x27;&#123;&quot;spec&quot;: &#123;&quot;type&quot;: &quot;NodePort&quot;&#125;&#125;&#x27;</span><br><span class="line">HubbleUiNodePort=$(kubectl get svc -n kube-system hubble-ui -o jsonpath=&#123;.spec.ports[0].nodePort&#125;)</span><br><span class="line">echo -e &quot;Hubble UI URL = http://$(curl -s ipinfo.io/ip):$HubbleUiNodePort&quot;</span><br><span class="line"></span><br><span class="line"># 자주 사용 명령</span><br><span class="line">helm upgrade cilium cilium/cilium --namespace kube-system --reuse-values --set</span><br><span class="line">kubetail -n kube-system -l k8s-app=cilium --since 12h</span><br><span class="line">kubetail -n kube-system -l k8s-app=cilium-envoy --since 12h</span><br></pre></td></tr></table></figure>



<p>자주 쓰는 Cilium CLI 명령어</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cilium 파드 확인</span></span><br><span class="line">kubectl get pod -n kube-system -l k8s-app=cilium -owide</span><br><span class="line"></span><br><span class="line"><span class="comment"># cilium 파드 재시작</span></span><br><span class="line">kubectl -n kube-system rollout restart ds/cilium</span><br><span class="line">혹은</span><br><span class="line">kubectl delete pod -n kube-system -l k8s-app=cilium</span><br><span class="line"></span><br><span class="line"><span class="comment"># cilium 설정 정보 확인</span></span><br><span class="line">cilium config view</span><br><span class="line"></span><br><span class="line"><span class="comment"># cilium 파드의 cilium 상태 확인</span></span><br><span class="line">c0 status --verbose</span><br><span class="line"></span><br><span class="line"><span class="comment"># cilium 엔드포인트 확인</span></span><br><span class="line">kubectl get ciliumendpoints -A</span><br><span class="line">c0 endpoint list</span><br><span class="line">c0 bpf endpoint list</span><br><span class="line">c0 map get cilium_lxc</span><br><span class="line">c0 ip list</span><br><span class="line"></span><br><span class="line"><span class="comment"># Manage the IPCache mappings for IP/CIDR &lt;-&gt; Identity</span></span><br><span class="line">c0 bpf ipcache list</span><br><span class="line"></span><br><span class="line"><span class="comment"># Service/NAT List 확인</span></span><br><span class="line">c0 service list</span><br><span class="line">c0 bpf lb list</span><br><span class="line">c0 bpf lb list --revnat</span><br><span class="line">c0 bpf nat list</span><br><span class="line"></span><br><span class="line"><span class="comment"># List all open BPF maps</span></span><br><span class="line">c0 map list</span><br><span class="line">c0 map list --verbose</span><br><span class="line"></span><br><span class="line"><span class="comment"># List contents of a policy BPF map : Dump all policy maps</span></span><br><span class="line">c0 bpf policy get --all</span><br><span class="line">c0 bpf policy get --all -n</span><br><span class="line"></span><br><span class="line"><span class="comment"># cilium monitor</span></span><br><span class="line">c0 monitor -v</span><br><span class="line">c0 monitor -v --<span class="built_in">type</span> l7</span><br></pre></td></tr></table></figure>



<p>Cilium 기본 정보 확인</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cilium 버전 확인</span></span><br><span class="line">cilium version</span><br><span class="line"></span><br><span class="line"><span class="comment"># cilium 상태 확인</span></span><br><span class="line">cilium status</span><br><span class="line"></span><br><span class="line"><span class="comment"># kube-proxy 파드 확인 &gt;&gt; 없다!</span></span><br><span class="line">kubectl get pod -A</span><br><span class="line"></span><br><span class="line"><span class="comment"># cilium 설정 정보 확인</span></span><br><span class="line">kubectl get cm -n kube-system cilium-config -o yaml</span><br><span class="line">cilium config view</span><br><span class="line"></span><br><span class="line"><span class="comment"># ciliumnodes(cn) 정보 확인</span></span><br><span class="line">kubectl get cn</span><br><span class="line">kubectl get cn k8s-m -o yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 노드별 파드 대역 확인</span></span><br><span class="line">kubectl get ciliumnodes -o yaml | grep podCIDRs -A1</span><br><span class="line"></span><br><span class="line"><span class="comment"># cilium 파드 확인</span></span><br><span class="line">kubectl get pod -n kube-system -l k8s-app=cilium -owide</span><br><span class="line"></span><br><span class="line"><span class="comment"># cilium 엔드포인트 확인</span></span><br><span class="line">kubectl get ciliumendpoints.cilium.io -A</span><br><span class="line"></span><br><span class="line">--------------------------------------------</span><br><span class="line"><span class="comment"># cilium cli 도움말</span></span><br><span class="line">c0 <span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cilium 파드의 cilium 상태 확인</span></span><br><span class="line">c0 status</span><br><span class="line">c1 status</span><br><span class="line">c2 status</span><br><span class="line">c0 status --verbose</span><br><span class="line"></span><br><span class="line"><span class="comment"># 각 노드에서 파드에 할당된 IP 확인</span></span><br><span class="line">c0 status --verbose | grep Allocated -A5</span><br><span class="line">c1 status --verbose | grep Allocated -A5</span><br><span class="line">c2 status --verbose | grep Allocated -A5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 엔드포인트 리스트 : ID, 정책, 라벨, IP 주소, 상태 확인</span></span><br><span class="line">c2 endpoint list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 노드 리스트</span></span><br><span class="line">c0 node list</span><br><span class="line"></span><br><span class="line"><span class="comment"># BFP(Direct access to local BPF maps)</span></span><br><span class="line"><span class="comment"># BFP 터널 리스트 확인 : Overlay Mode 사용 시 터널 정보 출력</span></span><br><span class="line">c0 bpf tunnel list</span><br><span class="line">	TUNNEL         VALUE</span><br><span class="line">	172.16.1.0:0   192.168.200.101:0</span><br><span class="line">	172.16.2.0:0   192.168.200.102:0</span><br><span class="line">c1 bpf tunnel list</span><br><span class="line">	TUNNEL         VALUE</span><br><span class="line">	172.16.2.0:0   192.168.200.102:0</span><br><span class="line">	172.16.0.0:0   192.168.200.10:0</span><br><span class="line">c2 bpf tunnel list</span><br><span class="line">	TUNNEL         VALUE</span><br><span class="line">	172.16.0.0:0   192.168.200.10:0</span><br><span class="line">	172.16.1.0:0   192.168.200.101:0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 해당 노드의 로컬 엔드포인트 리스트 : nodemac 은 해당 파드와 veth pair 인 인터페이스의 mac 주소이다!</span></span><br><span class="line">c0 bpf endpoint list</span><br><span class="line"></span><br><span class="line"><span class="comment"># Connection tracking tables - List connection tracking entries</span></span><br><span class="line">c0 bpf ct list global</span><br><span class="line"></span><br><span class="line"><span class="comment"># Flush all NAT mapping entries</span></span><br><span class="line">c0 bpf nat flush</span><br><span class="line"></span><br><span class="line"><span class="comment"># List all NAT mapping entries</span></span><br><span class="line">c0 bpf nat list</span><br><span class="line"></span><br><span class="line"><span class="comment"># service list 확인, Frontend 는 Service IP, Backend 는 Pod IP(endpoint IP)를 보여준다.</span></span><br><span class="line">c0 service list</span><br><span class="line"></span><br><span class="line"><span class="comment"># List load-balancing configuration</span></span><br><span class="line">c0 bpf lb list</span><br><span class="line"></span><br><span class="line"><span class="comment"># List reverse NAT entries</span></span><br><span class="line">c0 bpf lb list --revnat</span><br><span class="line"></span><br><span class="line"><span class="comment"># List all open BPF maps</span></span><br><span class="line">c0 map list</span><br><span class="line">c0 map list --verbose</span><br><span class="line">c0 map get cilium_lxc</span><br><span class="line">c0 map get cilium_ipcache</span><br><span class="line"></span><br><span class="line"><span class="comment"># cilium monitor</span></span><br><span class="line">c0 monitor -h</span><br><span class="line">c0 monitor -v</span><br><span class="line">c0 monitor -v --<span class="built_in">type</span> l7</span><br><span class="line"></span><br><span class="line"><span class="comment"># Cilium will automatically mount cgroup v2 filesystem required to attach BPF cgroup programs by default at the path /run/cilium/cgroupv2</span></span><br><span class="line">mount | grep cilium</span><br><span class="line">tree /run/cilium/cgroupv2/ -L 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># CNI Plugin 확인</span></span><br><span class="line">tree /etc/cni/net.d/</span><br><span class="line"><span class="built_in">cat</span> /etc/cni/net.d/05-cilium.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># Manage IP addresses and associated information - IP List</span></span><br><span class="line">c0 ip list</span><br><span class="line"></span><br><span class="line"><span class="comment"># IDENTITY :  1(host), 2(world), 4(health), 6(remote), 파드마다 개별 ID를 가지는 것으로 보인다!</span></span><br><span class="line">c0 ip list -n</span><br><span class="line"></span><br><span class="line"><span class="comment"># 엔드포인트 설정 확인 및 변경</span></span><br><span class="line">c0 endpoint config &lt;엔트포인트ID&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 엔드포인트 상세 정보 확인</span></span><br><span class="line">c0 endpoint get &lt;엔트포인트ID&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 엔드포인트 로그 확인</span></span><br><span class="line">c0 endpoint <span class="built_in">log</span> &lt;엔트포인트ID&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Show bpf filesystem mount details</span></span><br><span class="line">c0 bpf fs show</span><br><span class="line"></span><br><span class="line"><span class="comment"># bfp 마운트 폴더 확인</span></span><br><span class="line">tree /sys/fs/bpf</span><br><span class="line"></span><br><span class="line"><span class="comment"># List contents of a policy BPF map : Dump all policy maps</span></span><br><span class="line">c0 bpf policy get --all</span><br><span class="line">c0 bpf policy get --all -n</span><br><span class="line"></span><br><span class="line"><span class="comment"># BPF datapath traffic metrics</span></span><br><span class="line">c0 bpf metrics list</span><br><span class="line"></span><br><span class="line"><span class="comment"># Manage the IPCache mappings for IP/CIDR &lt;-&gt; Identity</span></span><br><span class="line">c0 bpf ipcache list</span><br><span class="line"></span><br><span class="line"><span class="comment"># Manage compiled BPF template objects</span></span><br><span class="line">c0 bpf sha list</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get datapath SHA header</span></span><br><span class="line">c0 bpf sha get &lt;Datapath SHA&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Retrieve information about an identity</span></span><br><span class="line">c0 identity list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 엔드포인트 기준 ID</span></span><br><span class="line">c0 identity list --endpoints</span><br><span class="line"></span><br><span class="line"><span class="comment"># Access metric status</span></span><br><span class="line">c0 metrics list</span><br></pre></td></tr></table></figure>



<p>네트워크 기본 정보 확인 : k8s-w1&#x2F;w2 에 SSH 접속 후 ip -c link&#x2F;route 정보 확인</p>
<p><img src="/blog/img/cilium-07.png"></p>
<p><img src="/blog/img/cilium-08.png"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 네트워크 인터페이스 정보 확인</span></span><br><span class="line">ip -br -c <span class="built_in">link</span></span><br><span class="line">ip -br -c addr</span><br><span class="line"></span><br><span class="line">--------------------------------------------</span><br><span class="line"><span class="comment"># cilium_net 과 cilium_host 는 veth peer 관계이며, cilium_host 는 파드의 GW IP 주소로 지정되며 32bit 이다</span></span><br><span class="line">ip -c addr show cilium_net ; ip -c addr show cilium_host</span><br><span class="line">3: cilium_net@cilium_host: &lt;BROADCAST,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 9001 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether b2:66:56:35:52:34 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet6 fe80::b066:56ff:fe35:5234/64 scope <span class="built_in">link</span></span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">4: cilium_host@cilium_net: &lt;BROADCAST,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 9001 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 76:76:84:b5:8d:5c brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.16.0.128/32 scope global cilium_host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::7476:84ff:feb5:8d5c/64 scope <span class="built_in">link</span></span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line"></span><br><span class="line"><span class="comment"># proxy arp 는 disable(0) 상태이며, 파드와 연결된 lxc 도 모두 0 이다</span></span><br><span class="line"><span class="comment"># 파드의 32bit ip의 gw 가 각각 연결된 veth 인터페이스의 mac 으로 cilium_host 의 IP/MAC 응답을 처리한다, 어떻게 동작이 되는걸까요? &gt;&gt; eBPF program!!!</span></span><br><span class="line"><span class="built_in">cat</span> /proc/sys/net/ipv4/conf/cilium_net/proxy_arp</span><br><span class="line">0</span><br><span class="line"><span class="built_in">cat</span> /proc/sys/net/ipv4/conf/cilium_host/proxy_arp</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"><span class="comment"># lxc_health 인터페이스는 veth 로 cilium(NET NS 0, 호스트와 다름)과 veth pair 이다 - 링크</span></span><br><span class="line"><span class="comment"># cilium 인터페이스에 파드 IP가 할당되어 있으며, cilium-health-responder 로 동작한다</span></span><br><span class="line">lsns -t net</span><br><span class="line"></span><br><span class="line">        NS TYPE NPROCS   PID USER     NETNSID NSFS                                                COMMAND</span><br><span class="line">4026531840 net     166     1 root  unassigned                                                     /sbin/init</span><br><span class="line">4026532265 net       2  5317 65535          2 /run/netns/cni-f7d5f8f0-c02e-02ca-525c-288b9fd72409 /pause</span><br><span class="line">4026532388 net       1  8317 root           0                                                     cilium-health-responder --listen 4240 --pidfile /var/run/cilium/state/health-endpoint.pid</span><br><span class="line">4026532390 net       2  5310 65535          1 /run/netns/cni-2dcffbeb-5e8d-d2b8-e920-f7d8bc2449ac /pause</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>Cilium Container Networking Control Flow - <a target="_blank" rel="noopener" href="https://docs.cilium.io/en/stable/network/concepts/ipam/deep_dive/">Link</a></p>
<p><img src="/blog/img/cilium-09.png"></p>
<h3 id="Hubble-UI-amp-CLI"><a href="#Hubble-UI-amp-CLI" class="headerlink" title="Hubble UI &amp; CLI"></a>Hubble UI &amp; CLI</h3><h3 id="Observability"><a href="#Observability" class="headerlink" title="Observability"></a>Observability</h3><ul>
<li>Network Observability with Hubble - <a target="_blank" rel="noopener" href="https://docs.cilium.io/en/stable/observability/hubble/">Link</a><ul>
<li>Setting up Hubble Observability - <a target="_blank" rel="noopener" href="https://docs.cilium.io/en/stable/observability/hubble/setup/">Link</a></li>
<li>Inspecting Network Flows with the CLI - <a target="_blank" rel="noopener" href="https://docs.cilium.io/en/stable/observability/hubble/hubble-cli/">Link</a></li>
<li>Service Map &amp; Hubble UI - <a target="_blank" rel="noopener" href="https://docs.cilium.io/en/stable/observability/hubble/hubble-ui/">Link</a></li>
<li>Configuring Hubble exporter - <a target="_blank" rel="noopener" href="https://docs.cilium.io/en/stable/observability/hubble/configuration/export/">Link</a></li>
<li>Configure TLS with Hubble - <a target="_blank" rel="noopener" href="https://docs.cilium.io/en/stable/observability/hubble/configuration/tls/">Link</a></li>
</ul>
</li>
<li><strong>Running Prometheus &amp; Grafana - <a target="_blank" rel="noopener" href="https://docs.cilium.io/en/stable/observability/grafana/">Link</a></strong></li>
<li>Monitoring &amp; Metrics - <a target="_blank" rel="noopener" href="https://docs.cilium.io/en/stable/observability/metrics/">Link</a></li>
<li>Layer 7 Protocol Visibility - <a target="_blank" rel="noopener" href="https://docs.cilium.io/en/stable/observability/visibility/">Link</a></li>
<li>Hubble for Network Observability and Security (Part 3): Leveraging Hubble Data for Network Security - <a target="_blank" rel="noopener" href="https://cilium.io/blog/2024/08/27/hubble-for-network-security-and-observability-part-3/">Link</a></li>
<li>Hubble for Network Observability and Security (Part 2): Utilizing Hubble for Network Observability - <a target="_blank" rel="noopener" href="https://cilium.io/blog/2024/08/19/hubble-for-network-security-and-observability-part-2/">Link</a></li>
<li>Hubble for Network Observability and Security (Part 1): Introduction to Cilium and Hubble - <a target="_blank" rel="noopener" href="https://cilium.io/blog/2024/08/14/hubble-for-network-security-and-observability-part-1/">Link</a></li>
</ul>
<h3 id="Hubble-소개-통신-및-서비스와-네트워킹-인프라의-동작에-대한-심층적인-가시성을-완전히-투명한-방식으로-제공하는-관찰성을-제공-Blog"><a href="#Hubble-소개-통신-및-서비스와-네트워킹-인프라의-동작에-대한-심층적인-가시성을-완전히-투명한-방식으로-제공하는-관찰성을-제공-Blog" class="headerlink" title="Hubble 소개 : 통신 및 서비스와 네트워킹 인프라의 동작에 대한 심층적인 가시성을 완전히 투명한 방식으로 제공하는 관찰성을 제공 - Blog"></a>Hubble 소개 : 통신 및 서비스와 네트워킹 인프라의 동작에 대한 심층적인 가시성을 완전히 투명한 방식으로 제공하는 관찰성을 제공 - <a target="_blank" rel="noopener" href="https://cilium.io/blog/2019/11/19/announcing-hubble">Blog</a></h3><ul>
<li>Hubble is a fully distributed networking and security observability platform. → <strong>네트워크&#x2F;보안 모니터링</strong></li>
<li>It is built on top of Cilium and eBPF to enable deep visibility into the communication and behavior of services as well as the networking infrastructure in a completely transparent manner. without requiring the application to change in any way. → 애플리케이션의 코드 수정 등 추가 설정 없이 동작</li>
<li>containerized workloads as well as more traditional workloads such as virtual machines and standard Linux processes. → VM&#x2F;서버도 모니터링 가능</li>
<li>By leveraging Linux eBPF, Cilium retains the ability to transparently insert security visibility + enforcement, but does so in a way that is based on service &#x2F; pod &#x2F; container identity (in contrast to IP address identification in traditional systems) and can filter on application-layer (e.g. HTTP). → 전통적인 IP 기반은 모니터링&#x2F;통제가 아니라 <strong>서비스&#x2F;파드&#x2F;ID 기반으로 모니터링&#x2F;통제</strong>를 제공</li>
<li>기본적으로 Hubble API는 Cilium 에이전트가 실행되는 개별 노드의 범위 내에서 작동합니다. 이는 네트워크 통찰력을 로컬 Cilium 에이전트가 관찰한 트래픽으로 제한합니다. Hubble <strong>CLI</strong>( <code>hubble</code>)를 사용하여 <strong>로컬 Unix Domain Socket</strong>을 통해 제공된 <strong>Hubble API를 쿼리</strong>할 수 있습니다. Hubble CLI 바이너리는 기본적으로 Cilium 에이전트 포드에 설치됩니다.</li>
<li><strong>Hubble Relay</strong>를 배포하면 전체 클러스터 또는 ClusterMesh 시나리오의 여러 <strong>클러스터에 대한 네트워크 가시성</strong>이 제공됩니다. 이 모드에서 Hubble 데이터는 Hubble CLI( <code>hubble</code>)를 Hubble Relay 서비스로 지정하거나 Hubble UI를 통해 액세스할 수 있습니다. Hubble UI는 L3&#x2F;L4 및 L7 계층에서 서비스 종속성 그래프를 자동으로 검색할 수 있는 웹 인터페이스로, 사용자 친화적인 시각화 및 서비스 맵으로서의 데이터 흐름 필터링을 허용합니다.</li>
</ul>
<p>Hubble UI&#x2F;CLI 접근 및 확인 - <a target="_blank" rel="noopener" href="https://docs.cilium.io/en/stable/observability/hubble/setup/#hubble-cli-install">Docs</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 확인</span></span><br><span class="line">cilium status</span><br><span class="line"></span><br><span class="line"><span class="comment"># UI 파드 정보 확인</span></span><br><span class="line">kubectl get pod -n kube-system -l k8s-app=hubble-ui -o wide</span><br><span class="line"></span><br><span class="line"><span class="comment"># Hubble UI 웹 접속</span></span><br><span class="line">kubectl patch -n kube-system svc hubble-ui -p <span class="string">&#x27;&#123;&quot;spec&quot;: &#123;&quot;type&quot;: &quot;NodePort&quot;&#125;&#125;&#x27;</span></span><br><span class="line">HubbleUiNodePort=$(kubectl get svc -n kube-system hubble-ui -o jsonpath=&#123;.spec.ports[0].nodePort&#125;)</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;Hubble UI URL = http://<span class="subst">$(curl -s ipinfo.io/ip)</span>:<span class="variable">$HubbleUiNodePort</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Service NodePort 생성 후 아래 정보 확인!</span></span><br><span class="line">iptables -t nat -S</span><br><span class="line">conntrack -L</span><br><span class="line">conntrack -L |grep -v 2379</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install Hubble Client</span></span><br><span class="line">HUBBLE_VERSION=$(curl -s https://raw.githubusercontent.com/cilium/hubble/master/stable.txt)</span><br><span class="line">HUBBLE_ARCH=amd64</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="subst">$(uname -m)</span>&quot;</span> = <span class="string">&quot;aarch64&quot;</span> ]; <span class="keyword">then</span> HUBBLE_ARCH=arm64; <span class="keyword">fi</span></span><br><span class="line">curl -L --fail --remote-name-all https://github.com/cilium/hubble/releases/download/<span class="variable">$HUBBLE_VERSION</span>/hubble-linux-<span class="variable">$&#123;HUBBLE_ARCH&#125;</span>.tar.gz&#123;,.<span class="built_in">sha256sum</span>&#125;</span><br><span class="line"><span class="built_in">sha256sum</span> --check hubble-linux-<span class="variable">$&#123;HUBBLE_ARCH&#125;</span>.tar.gz.sha256sum</span><br><span class="line">sudo tar xzvfC hubble-linux-<span class="variable">$&#123;HUBBLE_ARCH&#125;</span>.tar.gz /usr/local/bin</span><br><span class="line"><span class="built_in">rm</span> hubble-linux-<span class="variable">$&#123;HUBBLE_ARCH&#125;</span>.tar.gz&#123;,.<span class="built_in">sha256sum</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Hubble API Access : localhost TCP 4245 Relay 를 통해 접근, observe 를 통해서 flow 쿼리 확인 가능!</span></span><br><span class="line">cilium hubble port-forward &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># CLI 로 Hubble API 상태 확인</span></span><br><span class="line">hubble status</span><br><span class="line"></span><br><span class="line"><span class="comment"># query the flow API and look for flows</span></span><br><span class="line">hubble observe</span><br><span class="line"><span class="comment"># hubble observe --pod netpod</span></span><br><span class="line"><span class="comment"># hubble observe --namespace galaxy --http-method POST --http-path /v1/request-landing</span></span><br><span class="line"><span class="comment"># hubble observe --pod deathstar --protocol http</span></span><br><span class="line"><span class="comment"># hubble observe --pod deathstar --verdict DROPPED</span></span><br></pre></td></tr></table></figure>



<p><img src="/blog/img/cilium-10.png"></p>
<p>자가 테스트  cilium connectivity test → Hubble UI 접속 후 cilium-test-Y 네임스페이스 선택 ⇒ 30분 소요, 여유 시간에 실행 해볼것!</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cilium connectivity <span class="built_in">test</span></span><br></pre></td></tr></table></figure>



<p>삭제</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete ns cilium-test-Y</span><br></pre></td></tr></table></figure>









































</div><div class="article-licensing box"><div class="licensing-title"><p>cilium</p><p><a href="https://seongtaekkim.github.io/blog/2024/10/27/docs/cilium/cilium/">https://seongtaekkim.github.io/blog/2024/10/27/docs/cilium/cilium/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Seongtaek Kim</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2024-10-27</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2024-10-27</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="notification is-danger">You need to set <code>install_url</code> to use ShareThis. Please set it in <code>_config.yml</code>.</div></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" href="/blog/" target="_blank" rel="noopener" data-type="afdian"><span class="icon is-small"><i class="fas fa-charging-station"></i></span><span>Afdian.net</span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="/blog/" alt="Alipay"></span></a><a class="button donate" href="/blog/" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a><a class="button donate" href="/blog/" target="_blank" rel="noopener" data-type="patreon"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a><div class="notification is-danger">You forgot to set the <code>business</code> or <code>currency_code</code> for Paypal. Please set it in <code>_config.yml</code>.</div><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="/blog/" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/blog/2024/10/27/docs/cilium/communication/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">communication</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/blog/2024/10/27/docs/cilium/install/"><span class="level-item">install</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div class="notification is-danger">You forgot to set the <code>shortname</code> for Disqus. Please set it in <code>_config.yml</code>.</div></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/blog/img/avatar.png" alt="Seongtaek Kim"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Seongtaek Kim</p><p class="is-size-6 is-block">Blog</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/blog/archives"><p class="title">45</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/blog/categories"><p class="title">34</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/blog/tags"><p class="title">0</p></a></div></div></nav><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/seongtaekkim"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Linkedin" href="https://linkedin.com/in/staek"><i class="fab fa-linkedin"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/blog/categories/calico-communication/"><span class="level-start"><span class="level-item">calico/communication</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/calico-concept/"><span class="level-start"><span class="level-item">calico/concept</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/calico-networkmode/"><span class="level-start"><span class="level-item">calico/networkmode</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/cilium-cilium/"><span class="level-start"><span class="level-item">cilium/cilium</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/cilium-communication/"><span class="level-start"><span class="level-item">cilium/communication</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/cilium-install/"><span class="level-start"><span class="level-item">cilium/install</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/container-cgroup/"><span class="level-start"><span class="level-item">container/cgroup</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/container-namespace/"><span class="level-start"><span class="level-item">container/namespace</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/container-overlayFS/"><span class="level-start"><span class="level-item">container/overlayFS</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/container-overlaynetwork/"><span class="level-start"><span class="level-item">container/overlaynetwork</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/gateway-gatewayapi/"><span class="level-start"><span class="level-item">gateway/gatewayapi</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/gateway-gloo/"><span class="level-start"><span class="level-item">gateway/gloo</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/ingress-ingress/"><span class="level-start"><span class="level-item">ingress/ingress</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/istio-bookinfo/"><span class="level-start"><span class="level-item">istio/bookinfo</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/istio-envoy/"><span class="level-start"><span class="level-item">istio/envoy</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/istio-istio-outline/"><span class="level-start"><span class="level-item">istio/istio-outline</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/istio-istio-test/"><span class="level-start"><span class="level-item">istio/istio-test</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/istio-istio-traffic/"><span class="level-start"><span class="level-item">istio/istio-traffic</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/java-Enumeration/"><span class="level-start"><span class="level-item">java/Enumeration</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/java-flyweight/"><span class="level-start"><span class="level-item">java/flyweight</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/java-interface/"><span class="level-start"><span class="level-item">java/interface</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/k8s-PAUSE-Container/"><span class="level-start"><span class="level-item">k8s/PAUSE-Container</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/k8s-flannel/"><span class="level-start"><span class="level-item">k8s/flannel</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/k8s-kind/"><span class="level-start"><span class="level-item">k8s/kind</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/loadbaleancer-ipvs/"><span class="level-start"><span class="level-item">loadbaleancer/ipvs</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/loadbaleancer-ipvs-install/"><span class="level-start"><span class="level-item">loadbaleancer/ipvs-install</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/loadbaleancer-metalLB/"><span class="level-start"><span class="level-item">loadbaleancer/metalLB</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/loadbaleancer-metalLB-install/"><span class="level-start"><span class="level-item">loadbaleancer/metalLB-install</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/serivce-clusterip/"><span class="level-start"><span class="level-item">serivce/clusterip</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/serivce-install/"><span class="level-start"><span class="level-item">serivce/install</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/serivce-nodeport/"><span class="level-start"><span class="level-item">serivce/nodeport</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/vpccni-vpccni/"><span class="level-start"><span class="level-item">vpccni/vpccni</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/vpccni-vpccni-install/"><span class="level-start"><span class="level-item">vpccni/vpccni-install</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/vpccni-vpccni2/"><span class="level-start"><span class="level-item">vpccni/vpccni2</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-12-29T07:20:30.000Z">2024-12-29</time></p><p class="title"><a href="/blog/2024/12/29/docs/overlayFS/container-layer-stack/">Container Layer Stack</a></p><p class="categories"><a href="/blog/categories/container-overlayFS/">container/overlayFS</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-12-29T03:20:30.000Z">2024-12-29</time></p><p class="title"><a href="/blog/2024/12/29/docs/overlayFS/container-layer/">container layer</a></p><p class="categories"><a href="/blog/categories/container-overlayFS/">container/overlayFS</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-12-29T01:20:30.000Z">2024-12-29</time></p><p class="title"><a href="/blog/2024/12/29/docs/overlayFS/overlayFS/">Overlay Filesystem</a></p><p class="categories"><a href="/blog/categories/container-overlayFS/">container/overlayFS</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-12-22T08:30:35.000Z">2024-12-22</time></p><p class="title"><a href="/blog/2024/12/22/docs/loadbalancer/metallb/">MetalLB</a></p><p class="categories"><a href="/blog/categories/loadbaleancer-metalLB/">loadbaleancer/metalLB</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-12-22T07:30:35.000Z">2024-12-22</time></p><p class="title"><a href="/blog/2024/12/22/docs/loadbalancer/ipvs-proxy/">ipvs-proxy</a></p><p class="categories"><a href="/blog/categories/loadbaleancer-ipvs/">loadbaleancer/ipvs</a></p></div></article></div></div><!--!--></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/blog/">Blog</a><p class="is-size-7"><span>&copy; 2024 Seongtaek Kim</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/blog/js/column.js"></script><script src="/blog/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/blog/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/blog/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/blog/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/blog/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>